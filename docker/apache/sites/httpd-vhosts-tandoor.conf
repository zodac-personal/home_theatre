# Custom configuration for the Tandoor service
<VirtualHost *:80>
    ServerAdmin arouge110@msn.com
    ServerName recipe.zodac.me

    RequestHeader set X-Forwarded-Proto "https"
    Header always set Access-Control-Allow-Origin "*"

    ProxyPass / http://192.168.178.6:4010/
    ProxyPassReverse / http://192.168.178.6:4010/
    ProxyPreserveHost  On
    ProxyRequests Off

    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://192.168.178.6:4010/$1" [P,L]

    TimeOut 35
    ErrorDocument 502 https://status.zodac.me
    ErrorDocument 503 https://status.zodac.me

    ProxyPass /static/ !
    ProxyPass /media/ !

    Alias /static/ /var/www/recipes/staticfiles/
    Alias /media/ /var/www/recipes/mediafiles/
    <Directory /var/www/recipes/mediafiles>
        Require all granted
    </Directory>
    <Directory /var/www/recipes/staticfiles>
        Require all granted
    </Directory>
</VirtualHost>

